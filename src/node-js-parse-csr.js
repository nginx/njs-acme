
var pkijs = require("pkijs");
var asn1js = require("asn1js");
function pemToBuffer(pem, tag) {    return Buffer.from(pem.replace(new RegExp(`(-----BEGIN ${tag}-----|-----END ${tag}-----|\n)`, 'g'), ''), 'base64');}

const certInfo = {
    "chain": "-----BEGIN CERTIFICATE-----\nMIIDYTCCAkmgAwIBAgIIdmi5Qhr6KagwDQYJKoZIhvcNAQELBQAwKDEmMCQGA1UE\nAxMdUGViYmxlIEludGVybWVkaWF0ZSBDQSA2OWUwNDQwHhcNMjMwNTEwMTgwNjQz\nWhcNMjgwNTEwMTgwNjQzWjAaMRgwFgYDVQQDEw9wcm94eS5uZ2lueC5jb20wggEi\nMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCqPGkd5mmin4xf6Cq7w0yabF4C\nu3720PB9efRk/oXLdM55vA7PccP1IrNmhc8N8GmmFk6PLyNxrDsXnD/gL+LpMIeN\n4smC40PE2rkTfVaaux2DmDWPREFBeUzG/mTozWIbjQUQDRuVJS6HKhtjUAuWkSkT\nIWFUBI+tdN1l0NM51xbPBBG+FjUQfJB8oXBTBhi4GW3cuNSiyJG6ovgp5pEKXXOp\nAhxmHoY7c3rtRdL4CEkbQUB4Eroi9HMMj5/W09stR5jH7yQ2TfnFAwoo5/0C3tek\nzF+U9qUB6pk4CfvGl6FetOfgZrNsNAlx1tMF0O4ivCmqzyj7RpRXdsZj0wQRAgMB\nAAGjgZwwgZkwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggr\nBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBQ/N/kpkHPsJFB5URBmPFkn\nu9Q1TzAfBgNVHSMEGDAWgBQw5+z2AE2rvT1Yl76s6sqXj4jnBjAaBgNVHREEEzAR\ngg9wcm94eS5uZ2lueC5jb20wDQYJKoZIhvcNAQELBQADggEBAJFxqy5UoL8699+v\nB6Zteqdqk2nYkB49CiRoslWvQkYeaWPd0VF1eunU3KNwCgXWrhFKSEwwvPUfq33S\nC7oj0DGnOcLAU14sDDJ1FzFIGvRRgz3EmvpjFyV/ZaJAAtbajlsYItdsTQzKmrrn\nOGp9+aY8cxVtWjdlas4mGIuL9Wh8kZd/kdognchpZY04VbLn5JCvmm3Lgg27hsW8\nv9uPMVFZWyRzrsJq/m4QtDoRmhKgGaJcafQF7+1UYQVW1ekTjYD2iy4um2Mx+a8d\nL0TSU0qo3f8RJuDPJPSfCgPhG7VM4J+ISOQz6PFGqMe7MOLzQjeyn90Dyu+xJNw8\njZ/Cs30=\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIDUDCCAjigAwIBAgIIBL+v3PaQ4MAwDQYJKoZIhvcNAQELBQAwIDEeMBwGA1UE\nAxMVUGViYmxlIFJvb3QgQ0EgMTg4ZmFjMCAXDTIzMDUwOTE5MzQ1MloYDzIwNTMw\nNTA5MTkzNDUyWjAoMSYwJAYDVQQDEx1QZWJibGUgSW50ZXJtZWRpYXRlIENBIDY5\nZTA0NDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOQ3UaBVLDlJ8Qkl\n5MNXtYHg7z2A2kNb9tNm/wMAYPpDTLW7op6raCdbg7xr/Xhrt3I7NPNfcaOfGgkl\nlaLsaEHVW7HLIeAni/1pdjonZELPi/93vx1nNGyQ0wKIK2V29fIOTOnbT9sYaLki\nj9B9Sog4+Ddsx7eWGSWimiqKtG1eCQch/CP+CfqLtcMdmuosVvnobSr0+mAcrPkL\nRpnBE1rqBsoBO5IowfpVUtuzrV28JlviFn84oxa73pDwMFiLahElHkdZwbn3l8lZ\nn4Cq3kDiD1pqBWwPqf/iMSuJMY7NLlrStvfMrbvjiMSN8lh52GJFBgnsSZku0p8e\nyMwbaTcCAwEAAaOBgzCBgDAOBgNVHQ8BAf8EBAMCAoQwHQYDVR0lBBYwFAYIKwYB\nBQUHAwEGCCsGAQUFBwMCMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFDDn7PYA\nTau9PViXvqzqypePiOcGMB8GA1UdIwQYMBaAFLQuNyPufG3ansbdtW9kFgMgXHXa\nMA0GCSqGSIb3DQEBCwUAA4IBAQBqzolLpqcgpo3f4AfrurFz7kmn/KL7lWMlHYUe\njRNMbpIWYBhBoRSIOq8S/5g75hPy1PBKI/jheGSPSfzQAm+3HFfqNnpzFe1llDGI\n9hbNIGRoX52cbCd6LVB6MVyCY1IjOJrXilrd30Pj1rbCYtDKHfPDAQ+79vnluJ9p\nUhlj/nUi3R1uMeBVDQlQuJyAz+ppCv2IlyDGU7p1NjiBOBFCHLnlrXdk6p8AujRs\n+ACaOWAv38eJ0kHiyOiFnT+xQAi6NQevg+nt7EYWqOAsVwN9dVXFM3DdvEEDIit6\nvCQhELDt8oZbnjKNwSwSHTIBUE0OJmw2PzojDbrHEDVt01gz\n-----END CERTIFICATE-----\n",
    "cert1": "-----BEGIN CERTIFICATE-----\nMIIDYTCCAkmgAwIBAgIIdmi5Qhr6KagwDQYJKoZIhvcNAQELBQAwKDEmMCQGA1UE\nAxMdUGViYmxlIEludGVybWVkaWF0ZSBDQSA2OWUwNDQwHhcNMjMwNTEwMTgwNjQz\nWhcNMjgwNTEwMTgwNjQzWjAaMRgwFgYDVQQDEw9wcm94eS5uZ2lueC5jb20wggEi\nMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCqPGkd5mmin4xf6Cq7w0yabF4C\nu3720PB9efRk/oXLdM55vA7PccP1IrNmhc8N8GmmFk6PLyNxrDsXnD/gL+LpMIeN\n4smC40PE2rkTfVaaux2DmDWPREFBeUzG/mTozWIbjQUQDRuVJS6HKhtjUAuWkSkT\nIWFUBI+tdN1l0NM51xbPBBG+FjUQfJB8oXBTBhi4GW3cuNSiyJG6ovgp5pEKXXOp\nAhxmHoY7c3rtRdL4CEkbQUB4Eroi9HMMj5/W09stR5jH7yQ2TfnFAwoo5/0C3tek\nzF+U9qUB6pk4CfvGl6FetOfgZrNsNAlx1tMF0O4ivCmqzyj7RpRXdsZj0wQRAgMB\nAAGjgZwwgZkwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggr\nBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBQ/N/kpkHPsJFB5URBmPFkn\nu9Q1TzAfBgNVHSMEGDAWgBQw5+z2AE2rvT1Yl76s6sqXj4jnBjAaBgNVHREEEzAR\ngg9wcm94eS5uZ2lueC5jb20wDQYJKoZIhvcNAQELBQADggEBAJFxqy5UoL8699+v\nB6Zteqdqk2nYkB49CiRoslWvQkYeaWPd0VF1eunU3KNwCgXWrhFKSEwwvPUfq33S\nC7oj0DGnOcLAU14sDDJ1FzFIGvRRgz3EmvpjFyV/ZaJAAtbajlsYItdsTQzKmrrn\nOGp9+aY8cxVtWjdlas4mGIuL9Wh8kZd/kdognchpZY04VbLn5JCvmm3Lgg27hsW8\nv9uPMVFZWyRzrsJq/m4QtDoRmhKgGaJcafQF7+1UYQVW1ekTjYD2iy4um2Mx+a8d\nL0TSU0qo3f8RJuDPJPSfCgPhG7VM4J+ISOQz6PFGqMe7MOLzQjeyn90Dyu+xJNw8\njZ/Cs30=\n-----END CERTIFICATE-----",
    "csr": "-----BEGIN CERTIFICATE REQUEST-----\nMIIC5DCCAc4CAQAwSTFHMAkGA1UEBhMCVVMwCQYDVQQIDAJXQTAJBgNVBAoMAkY1\nMAwGA1UECwwFTkdJTlgwFgYDVQQDDA9wcm94eS5uZ2lueC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCqPGkd5mmin4xf6Cq7w0yabF4Cu3720PB9\nefRk/oXLdM55vA7PccP1IrNmhc8N8GmmFk6PLyNxrDsXnD/gL+LpMIeN4smC40PE\n2rkTfVaaux2DmDWPREFBeUzG/mTozWIbjQUQDRuVJS6HKhtjUAuWkSkTIWFUBI+t\ndN1l0NM51xbPBBG+FjUQfJB8oXBTBhi4GW3cuNSiyJG6ovgp5pEKXXOpAhxmHoY7\nc3rtRdL4CEkbQUB4Eroi9HMMj5/W09stR5jH7yQ2TfnFAwoo5/0C3tekzF+U9qUB\n6pk4CfvGl6FetOfgZrNsNAlx1tMF0O4ivCmqzyj7RpRXdsZj0wQRAgMBAAGgWDBW\nBgkqhkiG9w0BCQ4xSTBHMCkGA1UdDgQiBCCFZ8rs5phpBf85deQExG0ZHtsmdb/c\nGR6OeyjMlZLKSTAaBgNVHREEEzARgg9wcm94eS5uZ2lueC5jb20wCwYJKoZIhvcN\nAQELA4IBAQAUOm4vlNEjQqerZUUCzWSDWFdoqJndlvP/W9jHXlfhN8TzuxTa3Kpw\ngTAi1g7C9aXG5VRRbjsBlQdd4ZiCJb25p1ZNkoCxBtZkKx0iSpc6NMQtMEp4vqs2\n8qYBMrgmkgJDKxdSW5VNy+iwgBFo9lGbi39Z4FW1H0CPsWJFMDv9hZ4MO1KDZj52\nRSAVfEL9llhTTAHfVtE8S/w83bY4vW4YP/T9xaIIo6FGXym9zAdCuuLIGwWnJZHY\ns1djC/Y7I/4PzRFSA7I4nVCRemCXL87UBlAtnzfQUJtqZJG5CrLAu6iVyUcR518e\nPj5TnxWscSvixbcNWmlz586M2cj9xYrn\n-----END CERTIFICATE REQUEST-----\n"
};



const domainNames = [];
const csrBuffer = pemToBuffer(certInfo.csr, "CERTIFICATE REQUEST");
const csr = pkijs.CertificationRequest.fromBER(csrBuffer);
const subjectName = csr.subject.typesAndValues.find(o => o.type == "2.5.4.3");
if (subjectName) {
    domainNames.push(subjectName.value.valueBlock.value);
}
console.log(`domainNames: ${domainNames}`);

const extensionRequestAttr = csr.attributes?.find(o => o.type === "1.2.840.113549.1.9.14");
const extensions = new pkijs.Extensions({ schema: extensionRequestAttr.values[0] });
var sanExt = extensions.extensions.find((o) => o.extnID === "2.5.29.17");
var sextSchema = sanExt.toSchema();
var ext = new pkijs.Extension();
ext.fromSchema(sextSchema);
for (const v of ext.parsedValue.altNames ) {  console.log(v.value);}
